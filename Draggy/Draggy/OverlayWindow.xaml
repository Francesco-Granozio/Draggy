<Window
    x:Class="Draggy.OverlayWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:Draggy"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Title="Draggy"
    Width="250"
    Height="400"
    MinWidth="220"
    MinHeight="160"
    AllowDrop="True"
    AllowsTransparency="True"
    Background="Transparent"
    ShowInTaskbar="True"
    Topmost="True"
    WindowStyle="None"
    ResizeMode="CanResize"
    mc:Ignorable="d">
    <Border
        x:Name="MainBorder"
        AllowDrop="True"
        Background="#15FFFFFF"
        BorderBrush="#30CCCCCC"
        BorderThickness="1"
        CornerRadius="16"
        DragEnter="Grid_DragEnter"
        DragLeave="Grid_DragLeave"
        DragOver="Grid_DragOver"
        Drop="Grid_Drop">
        <Grid>
            <!-- Bordo di ridimensionamento -->
            <Border
                x:Name="ResizeBorder"
                Background="Transparent"
                BorderBrush="Transparent"
                BorderThickness="4"
                CornerRadius="16"
                MouseLeftButtonDown="ResizeBorder_MouseLeftButtonDown"
                MouseMove="ResizeBorder_MouseMove" />
            
            <!-- Contenuto principale -->
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

            <!--  Header con titolo, pulsante clear e controlli finestra  -->
            <Border
                Grid.Row="0"
                Padding="16,12"
                Background="#E0F5F5F5"
                CornerRadius="16,16,0,0"
                MouseLeftButtonDown="Header_MouseLeftButtonDown">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <StackPanel Grid.Column="0" Orientation="Horizontal">
                        <TextBlock
                            VerticalAlignment="Center"
                            FontSize="13"
                            FontWeight="SemiBold"
                            FontFamily="Segoe UI"
                            Foreground="#1D1D1F"
                            Text="Draggy" />
                    </StackPanel>
                    
                    <!-- Clear list (delete_items.png) -->
                    <Button
                        Grid.Column="1"
                        Margin="8,0,0,0"
                        Padding="4"
                        Background="Transparent"
                        BorderThickness="0"
                        Command="{Binding ClearAllCommand}"
                        ToolTip="Rimuove tutti i file dalla lista e pulisce anche la cache thumbnail. I file nella cache vengono rimossi.">
                        <Image Width="16" Height="16" Source="pack://application:,,,/Resources/delete_items.png"/>
                    </Button>
                        
                    <!-- Clear cache (delete_cache.png) -->
                    <Button
                        Grid.Column="2"
                        Margin="8,0,0,0"
                        Padding="4"
                        Background="Transparent"
                        BorderThickness="0"
                        Click="ClearCacheButton_Click"
                        ToolTip="Cancella l’intera cache locale dei file salvati e miniature. Utile per liberare spazio o ripartire da zero.">
                        <Image Width="16" Height="16" Source="pack://application:,,,/Resources/delete_cache.png"/>
                    </Button>
                        
                    <Button
                        Grid.Column="3"
                        Margin="8,0,0,0"
                        Padding="6,2"
                        Background="Transparent"
                        BorderThickness="0"
                        Click="MinimizeButton_Click"
                        Content="−"
                        FontSize="12"
                        FontFamily="Segoe UI"
                        FontWeight="SemiBold"
                        Foreground="#007AFF" />
                </Grid>
            </Border>

                         <!--  Area shelf con scroll  -->
             <ScrollViewer
                 Grid.Row="1"
                 Margin="10"
                 VerticalScrollBarVisibility="Auto">
                 <ItemsControl x:Name="ItemsControlFiles" ItemsSource="{Binding Items}">
                     <ItemsControl.ItemTemplate>
                         <DataTemplate>
                             <Border
                                 Margin="2,4"
                                 Padding="6"
                                 Background="#F8FFFFFF"
                                 BorderBrush="#15C0C0C0"
                                 BorderThickness="1"
                                 CornerRadius="8"
                                 Cursor="Arrow">
                                 <Grid>
                                     <Grid.ColumnDefinitions>
                                         <ColumnDefinition Width="Auto" />
                                         <ColumnDefinition Width="*" />
                                         <ColumnDefinition Width="Auto" />
                                     </Grid.ColumnDefinitions>

                                     <Image
                                         Grid.Column="0"
                                         Width="22"
                                         Height="22"
                                         Margin="0,0,8,0"
                                         Source="{Binding Thumbnail}"
                                         Stretch="Uniform" />

                                     <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                         <TextBlock
                                             FontSize="10"
                                             FontWeight="Medium"
                                             FontFamily="Segoe UI"
                                             Foreground="#1D1D1F"
                                             Text="{Binding FileName}"
                                             TextTrimming="CharacterEllipsis" />
                                         <TextBlock
                                             FontSize="8"
                                             FontFamily="Segoe UI"
                                             Foreground="#86868B"
                                             Text="{Binding OriginalPath}"
                                             TextTrimming="CharacterEllipsis" />
                                     </StackPanel>

                                     <Button
                                         Grid.Column="2"
                                         Padding="2"
                                         Background="Transparent"
                                         BorderThickness="0"
                                         Command="{Binding DataContext.RemoveItemCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                         CommandParameter="{Binding}"
                                         Content="×"
                                         FontSize="12"
                                         FontFamily="Segoe UI"
                                         FontWeight="SemiBold"
                                         Foreground="#9AA0A6">
                                         <Button.Style>
                                             <Style TargetType="Button">
                                                 <Setter Property="Visibility" Value="Collapsed"/>
                                                 <Setter Property="Foreground" Value="#9AA0A6"/>
                                                 <Style.Triggers>
                                                     <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=Border}, Path=IsMouseOver}" Value="True">
                                                         <Setter Property="Visibility" Value="Visible"/>
                                                         <Setter Property="Foreground" Value="#FF3B30"/>
                                                     </DataTrigger>
                                                     <Trigger Property="IsMouseOver" Value="True">
                                                         <Setter Property="Foreground" Value="#FF3B30"/>
                                                     </Trigger>
                                                 </Style.Triggers>
                                             </Style>
                                         </Button.Style>
                                     </Button>
                                 </Grid>

                                 <Border.ContextMenu>
                                     <ContextMenu Placement="MousePoint">
                                         <ContextMenu.Resources>
                                             <Style TargetType="MenuItem">
                                                 <Setter Property="FontFamily" Value="Segoe UI"/>
                                                 <Setter Property="FontSize" Value="12"/>
                                             </Style>
                                         </ContextMenu.Resources>
                                         <MenuItem Header="Apri file"
                                                   Command="{Binding OpenFileCommand}">
                                             <MenuItem.Icon>
                                                 <Image Width="16" Height="16" Source="{Binding FileIcon16}"/>
                                             </MenuItem.Icon>
                                         </MenuItem>
                                         <MenuItem Header="Copia percorso"
                                                   Command="{Binding CopyPathCommand}">
                                             <MenuItem.Icon>
                                                 <Image Width="16" Height="16" Source="pack://application:,,,/Resources/copy_path.png"/>
                                             </MenuItem.Icon>
                                         </MenuItem>
                                         <MenuItem Header="Apri percorso"
                                                   Command="{Binding OpenFolderCommand}">
                                             <MenuItem.Icon>
                                                 <Image Width="16" Height="16" Source="pack://application:,,,/Resources/open_folder.png"/>
                                             </MenuItem.Icon>
                                         </MenuItem>
                                     </ContextMenu>
                                 </Border.ContextMenu>
                             </Border>
                         </DataTemplate>
                     </ItemsControl.ItemTemplate>
                 </ItemsControl>
             </ScrollViewer>
            </Grid>
        </Grid>
    </Border>
</Window>

