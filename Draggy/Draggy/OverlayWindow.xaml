<Window
    x:Class="Draggy.OverlayWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:Draggy"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Title="Draggy"
    Width="250"
    Height="400"
    MinWidth="220"
    MinHeight="160"
    AllowDrop="True"
    AllowsTransparency="True"
    Background="Transparent"
    ShowInTaskbar="True"
    Topmost="True"
    WindowStyle="None"
    ResizeMode="CanResize"
    mc:Ignorable="d">
    <Border
        x:Name="MainBorder"
        AllowDrop="True"
        Background="#15FFFFFF"
        BorderBrush="#30CCCCCC"
        BorderThickness="1"
        CornerRadius="16"
        DragEnter="Grid_DragEnter"
        DragLeave="Grid_DragLeave"
        DragOver="Grid_DragOver"
        Drop="Grid_Drop">
        <Grid>
            <!-- Bordo di ridimensionamento -->
            <Border
                x:Name="ResizeBorder"
                Background="Transparent"
                BorderBrush="Transparent"
                BorderThickness="4"
                CornerRadius="16"
                MouseLeftButtonDown="ResizeBorder_MouseLeftButtonDown"
                MouseMove="ResizeBorder_MouseMove" />
            
            <!-- Contenuto principale -->
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

            <!--  Header con titolo, pulsante clear e controlli finestra  -->
            <Border
                Grid.Row="0"
                Padding="16,12"
                Background="#E0F5F5F5"
                CornerRadius="16,16,0,0"
                MouseLeftButtonDown="Header_MouseLeftButtonDown">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <StackPanel Grid.Column="0" Orientation="Horizontal">
                        <TextBlock
                            VerticalAlignment="Center"
                            FontSize="13"
                            FontWeight="SemiBold"
                            FontFamily="Segoe UI"
                            Foreground="#1D1D1F"
                            Text="Draggy" />
                    </StackPanel>
                    
                    <Button
                        Grid.Column="1"
                        Margin="8,0,0,0"
                        Padding="6,2"
                        Background="Transparent"
                        BorderThickness="0"
                        Command="{Binding ClearAllCommand}"
                        Content="Clear"
                        FontSize="11"
                        FontFamily="Segoe UI"
                        FontWeight="Medium"
                        Foreground="#007AFF" />
                        
                    <Button
                        Grid.Column="2"
                        Margin="8,0,0,0"
                        Padding="6,2"
                        Background="Transparent"
                        BorderThickness="0"
                        Click="ClearCacheButton_Click"
                        Content="Cache"
                        FontSize="11"
                        FontFamily="Segoe UI"
                        FontWeight="Medium"
                        Foreground="#007AFF" />
                        
                    <Button
                        Grid.Column="3"
                        Margin="8,0,0,0"
                        Padding="6,2"
                        Background="Transparent"
                        BorderThickness="0"
                        Click="MinimizeButton_Click"
                        Content="−"
                        FontSize="12"
                        FontFamily="Segoe UI"
                        FontWeight="SemiBold"
                        Foreground="#007AFF" />
                </Grid>
            </Border>

                         <!--  Area shelf con scroll  -->
             <ScrollViewer
                 Grid.Row="1"
                 Margin="12"
                 VerticalScrollBarVisibility="Auto">
                 <ItemsControl x:Name="ItemsControlFiles" ItemsSource="{Binding Items}">
                     <ItemsControl.ItemTemplate>
                         <DataTemplate>
                             <Border
                                 Margin="2,6"
                                 Padding="12"
                                 Background="#F0FFFFFF"
                                 BorderBrush="#20E5E5E7"
                                 BorderThickness="1"
                                 CornerRadius="10"
                                 Cursor="Hand">
                                 <Grid>
                                     <Grid.ColumnDefinitions>
                                         <ColumnDefinition Width="Auto" />
                                         <ColumnDefinition Width="*" />
                                         <ColumnDefinition Width="Auto" />
                                     </Grid.ColumnDefinitions>

                                     <Image
                                         Grid.Column="0"
                                         Width="36"
                                         Height="36"
                                         Margin="0,0,12,0"
                                         Source="{Binding Thumbnail}"
                                         Stretch="Uniform" />

                                     <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                         <TextBlock
                                             FontSize="12"
                                             FontWeight="Medium"
                                             FontFamily="Segoe UI"
                                             Foreground="#1D1D1F"
                                             Text="{Binding FileName}"
                                             TextTrimming="CharacterEllipsis" />
                                         <TextBlock
                                             FontSize="10"
                                             FontFamily="Segoe UI"
                                             Foreground="#86868B"
                                             Text="{Binding OriginalPath}"
                                             TextTrimming="CharacterEllipsis" />
                                     </StackPanel>

                                     <Button
                                         Grid.Column="2"
                                         Padding="6"
                                         Background="Transparent"
                                         BorderThickness="0"
                                         Command="{Binding DataContext.RemoveItemCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                         CommandParameter="{Binding}"
                                         Content="×"
                                         FontSize="14"
                                         FontFamily="Segoe UI"
                                         FontWeight="SemiBold"
                                         Foreground="#FF3B30" />
                                 </Grid>

                                 <Border.ContextMenu>
                                     <ContextMenu Placement="MousePoint">
                                         <ContextMenu.Resources>
                                             <Style TargetType="MenuItem">
                                                 <Setter Property="FontFamily" Value="Segoe UI"/>
                                                 <Setter Property="FontSize" Value="12"/>
                                             </Style>
                                         </ContextMenu.Resources>
                                         <MenuItem Header="Apri file"
                                                   Command="{Binding OpenFileCommand}">
                                             <MenuItem.Icon>
                                                 <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE8E5;"/>
                                             </MenuItem.Icon>
                                         </MenuItem>
                                         <MenuItem Header="Copia percorso"
                                                   Command="{Binding CopyPathCommand}">
                                             <MenuItem.Icon>
                                                 <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE8C8;"/>
                                             </MenuItem.Icon>
                                         </MenuItem>
                                         <MenuItem Header="Apri percorso"
                                                   Command="{Binding OpenFolderCommand}">
                                             <MenuItem.Icon>
                                                 <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE838;"/>
                                             </MenuItem.Icon>
                                         </MenuItem>
                                     </ContextMenu>
                                 </Border.ContextMenu>
                             </Border>
                         </DataTemplate>
                     </ItemsControl.ItemTemplate>
                 </ItemsControl>
             </ScrollViewer>
            </Grid>
        </Grid>
    </Border>
</Window>

